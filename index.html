<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ativação de Plano</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">

    <style>
        /* Fallback font style in case the inline style is stripped */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body style="
    font-family: 'Inter', sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
    background-color: #111827;
    background-image:
        radial-gradient(at 27% 37%, hsla(215, 98%, 42%, 0.4) 0px, transparent 50%),
        radial-gradient(at 97% 21%, hsla(125, 98%, 42%, 0.2) 0px, transparent 50%),
        radial-gradient(at 52% 99%, hsla(355, 98%, 42%, 0.4) 0px, transparent 50%),
        radial-gradient(at 10% 29%, hsla(256, 96%, 41%, 0.3) 0px, transparent 50%),
        radial-gradient(at 97% 96%, hsla(38, 60%, 74%, 0.2) 0px, transparent 50%),
        radial-gradient(at 33% 50%, hsla(222, 67%, 73%, 0.3) 0px, transparent 50%),
        radial-gradient(at 79% 53%, hsla(343, 68%, 79%, 0.4) 0px, transparent 50%);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
">

    <!-- Main container -->
    <div class="w-full max-w-md mx-auto p-6 md:p-8 bg-black bg-opacity-70 backdrop-blur-sm rounded-2xl shadow-2xl m-4">

        <!-- Main Title -->
        <h1 class="text-3xl md:text-4xl font-extrabold text-white text-center mb-4 mt-6">
            Obrigado por adquirir o sistema OTT-Plus!
        </h1>

        <!-- Attention Box -->
        <div class="bg-yellow-500 bg-opacity-10 border border-yellow-400 text-yellow-300 p-4 rounded-lg text-center my-6">
            <h2 class="text-xl font-bold text-yellow-300 mb-2">ATENÇÃO</h2>
            <p class="text-sm md:text-base leading-relaxed">
                Salve o nosso número de whatsapp para não perder o nosso contato caso queira renovar o plano ou solicitar suporte.
            </p>
        </div>

        <!-- Promotion Box -->
        <div class="bg-green-500 bg-opacity-10 border border-green-400 text-green-300 p-4 rounded-lg text-center my-6">
             <p class="text-sm md:text-base font-semibold leading-relaxed">
                Você ganha meses <span class="font-bold text-white">100% GRÁTIS</span> ao indicar pessoas a conhecerem a plataforma!
            </p>
        </div>

        <!-- Activation Text -->
        <p class="text-gray-300 text-center text-lg mb-6">
            Para ativar o plano: <span class="font-semibold text-white">basta clicar em confirmar</span>
        </p>

        <!-- Activation Button -->
        <button id="activationButton" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-6 rounded-lg text-lg transition-all duration-300 ease-in-out transform hover:scale-105 shadow-lg shadow-red-600/30">
            CONFIRMAR E ATIVAR
        </button>

        <!-- Confirmation Message (hidden by default) -->
        <div id="confirmationMessage" class="hidden mt-6 p-4 bg-blue-500 bg-opacity-20 border border-blue-400 text-blue-200 rounded-lg text-center">
            <p class="font-semibold">Plano ativado com sucesso! Redirecionando para o WhatsApp...</p>
        </div>

    </div>

    <script>
        // JavaScript to handle the button click, Meta API call, and redirect.
        const activationButton = document.getElementById('activationButton');
        const confirmationMessage = document.getElementById('confirmationMessage');

        const PIXEL_ID = '751010403991913';  // Seu Pixel ID
        const ACCESS_TOKEN = 'EAASBWjt5Y3UBPFZCgV08wEMxFig3goRXkppaXc5Tg8ZBR5JM6z5QQ1ouGZAlNaBBT8ZADaPYj8ZCZB2sqXqsZCuvGoX8FoatCEVbWi48mCQMdkhvaMTBhdiIVIWNRIfYaIrBKlsNrMJURmqAw1Xr6vC51dYX3SVIqFhZAHBdxZAfpaf1PaB23HkeFNescKSRmBIGDzwZDZD';  // Seu Access Token
        const phoneNumber = '5583981647312';  // Seu número de WhatsApp
        const message = 'O meu código de ativação do plano é 8037847. Por favor, ative meu acesso.';

        /**
         * Sends the Purchase event to the Meta Conversions API.
         */
        async function sendConversionApiEvent() {
            const eventId = crypto.randomUUID(); // Generate a unique ID for event deduplication
            const eventData = {
                data: [{
                    event_name: 'Assinatura',  // Nome do evento ajustado
                    event_time: Math.floor(Date.now() / 1000),
                    action_source: 'website',
                    event_id: eventId,
                    user_data: {},
                    custom_data: {}
                }],
                access_token: ACCESS_TOKEN,
            };

            try {
                const response = await fetch(`https://graph.facebook.com/v20.0/${PIXEL_ID}/events`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(eventData),
                });

                const responseData = await response.json();
                if (response.ok) {
                    console.log('Evento de ativação enviado com sucesso:', responseData);
                } else {
                    console.error('Erro ao enviar evento de ativação:', responseData);
                }
            } catch (error) {
                console.error('Falha ao enviar a requisição de ativação:', error);
            }
        }

        activationButton.addEventListener('click', () => {
            // 1. Fire the Meta Pixel event on the browser side.
            fbq('track', 'PageView'); // Registra visualização da página
            fbq('track', 'Assinatura'); // Registra a ativação do plano
            console.log('Evento "Assinatura" disparado no Meta Pixel.');

            // 2. Send the event via the server-side Conversions API.
            sendConversionApiEvent();

            // 3. Update the UI to show confirmation.
            activationButton.style.display = 'none';
            confirmationMessage.classList.remove('hidden');

            // 4. Prepare the WhatsApp URL and redirect the user.
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;

            // Redirect after a short delay to ensure API calls have time to be sent.
            setTimeout(() => {
                window.location.href = whatsappUrl;
            }, 800); // 800ms delay
        });
    </script>

</body>
</html>
